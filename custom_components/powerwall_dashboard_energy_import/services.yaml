
backfill:
  name: Backfill energy data
  description: >
    Imports historical energy data from InfluxDB into Home Assistant.
    You must provide either a start date or the 'all' flag.
  fields:
    all:
      name: All
      description: "If true, backfills all data from the earliest record in InfluxDB."
      example: true
      selector:
        boolean:
    start:
      name: Start date
      description: "The first day to include in the backfill (e.g., '2023-01-01')."
      example: "2023-01-01"
      selector:
        text:
    end:
      name: End date
      description: "The last day to include in the backfill (e.g., '2023-12-31'). Defaults to today."
      example: "2023-12-31"
      selector:
        text:
    sensor_prefix:
      name: Sensor prefix
      description: "The device name (pw_name) of the Powerwall integration to backfill."
      example: "My Powerwall"
      selector:
        text:
    overwrite_existing:
      name: Overwrite existing statistics
      description: "Replace existing statistics in the date range. WARNING: This will permanently delete existing data. For the current day, only backfills up to the current hour to prevent blocking live data collection."
      default: false
      selector:
        boolean:
    clear_short_term:
      name: Clear short-term statistics
      description: "Delete 5-minute statistics for the targeted sensors before backfilling, keeping the most recent row so recorder baseline stays intact."
      default: false
      selector:
        boolean:
    repair_short_term_baseline:
      name: Repair short-term baseline
      description: "Align the most recent 5-minute statistics sum/state with the latest long-term sum to prevent hourly rollovers from dropping to near-zero."
      default: false
      selector:
        boolean:
    start_hour:
      name: Start hour (Manual Surgical Repair)
      description: "Start hour for targeted hour-range backfill (0-23). Use for manually fixing specific problematic hours. Leave empty for full day backfill."
      example: 19
      selector:
        number:
          min: 0
          max: 23
          mode: box
    end_hour:
      name: End hour (Manual Surgical Repair)
      description: "End hour for targeted hour-range backfill (1-24). Use for manually fixing specific problematic hours. Leave empty for full day backfill."
      example: 20
      selector:
        number:
          min: 1
          max: 24
          mode: box

migrate_from_teslemetry:
  name: Migrate from Teslemetry
  description: >
    Migrates historical energy statistics from Teslemetry entities to this integration's entities.
    This preserves your Energy Dashboard history while transitioning to the custom integration.
  fields:
    auto_discover:
      name: Auto-discover entities
      description: "Automatically find Teslemetry energy entities to migrate."
      default: true
      selector:
        boolean:
    entity_prefix:
      name: Entity prefix
      description: "Entity prefix for Tesla entities (e.g., 'my_home', 'tesla_site', 'powerwall'). Helps auto-discovery find entities with non-standard naming."
      example: "my_home"
      selector:
        text:
    sensor_prefix:
      name: Sensor prefix
      description: "Target Powerwall Dashboard integration sensor prefix (e.g., 'pw085'). Ensures migration targets the correct integration instance."
      example: "pw085"
      selector:
        text:
    entity_mapping:
      name: Manual entity mapping
      description: "Override auto-discovery with manual entity mappings (JSON format)."
      example: '{"sensor.tesla_home_energy": "sensor.powerwall_dashboard_home_usage_daily"}'
      selector:
        text:
          multiline: true
    start_date:
      name: Start date
      description: "Earliest date to migrate (YYYY-MM-DD). Leave empty for all available data."
      example: "2023-01-01"
      selector:
        text:
    end_date:
      name: End date
      description: "Latest date to migrate (YYYY-MM-DD). Leave empty for all available data."
      example: "2024-12-31"
      selector:
        text:
    dry_run:
      name: Dry run
      description: "Preview migration without importing data."
      default: false
      selector:
        boolean:
    overwrite_existing:
      name: Overwrite existing statistics
      description: "Replace existing statistics in target entities."
      default: false
      selector:
        boolean:
    merge_strategy:
      name: Merge strategy
      description: "How to handle overlapping data with InfluxDB backfill."
      default: "prioritize_influx"
      selector:
        select:
          options:
            - "prioritize_influx"
            - "prioritize_teslemetry"
